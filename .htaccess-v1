# .htaccess - AliveChMS API
# Secure and clean URL routing

##### OLD CODE #####
# RewriteEngine On
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteRule ^(.*)$ index.php?path=$1 [QSA,L]


# Prevent directory listing
Options -Indexes

# Enable rewrite engine
RewriteEngine On

# Block access to sensitive files
RewriteRule ^(\.env|\.git|composer\.json|composer\.lock|vendor/|logs/|core/|routes/) - [F,L,NC]

# Block common malicious patterns
RewriteCond %{QUERY_STRING} (\.\.\/|\.\.%2f|%2e%2e%2f|%252e%252e%252f|~|\^|`|\[|\]|\.\.\/) [NC]
RewriteRule .* - [F,L]

# Route all requests to index.php (except existing files/directories)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?path=$1 [QSA,L]

# Security headers (if not set in PHP)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'"
</IfModule>

# Disable server signature
ServerSignature Off